# 第六章 类文件结构

## 1. Class类文件的结构

* **1.1 Class文件结构**
    > Class文件是一组以8位字节为基础单位的二进制流，各个数据项**严格按照顺序紧凑排列**在Class文件中。Class文件采用一种伪结构来存储数据，这种伪结构中只有两种数据类型：**无符号数和表**
    > * 无符号数 ：属于基本的数据类型，以u1、u2、u4、u8来分别代表一个字节、两个字节、四个字节和八个字节的无符号数。可以用来描述数字、索引引用、数量值或字符串值
    > * 表 ：是由多个无符号数或者其他表作为数据项构成的复合数据类型，习惯以 " _info " 结尾
* **1.2使用Javap工具分析Class文件**
    > 命令格式：javap -verbose fileName.class
* **1.3 魔数与Class文件的版本**
    > 每个Class文件的头 4个字节称为魔数，它唯一的作用就是确定这个文件是否为一个能被虚拟机接受的Class文件。值为：**0xCAFEBABE** ( 咖啡宝贝？)
    > 紧接着魔数的四个字节存储的是Class文件的版本号：第五、第六个字节是次版本号，第七、第八个字节是主版本号
* **1.4 常量池**
    > 紧接着主次版本号之后的就是常量池入口，常量池可以理解为Class文件中的资源仓库
    > * 常量池入口放置着一项u2类型的数据，代表常量池容量的计数值，从1开始计数
    > * 常量池主要存放两大类常量：字面量和符号引用
* **1.5 访问标志**
    > 在常量池结束之后紧接着的两个字节代表访问标志 ( access_flags ) ，这些访问标志用于识别一些类或者接口层次的访问信息
    > * 这个Class是类还是接口
    > * 是否定义为public类型
    > * 是否定义为abstract类型
    > * 如果是类的话是否被声明为final
* **1.6 类索引、父类索引与接口索引集合**
    > 类索引和父类索引都是一个u2类型数据，而接口索引是**一组u2类型数据**集合，Class文件中用这三项数据来确定这个类的继承关系,存储位置按顺序排列在访问标志之后
    > * 类索引 ：确定这个类的全限定名
    > * 父类索引 ：确定这个类的父类的全限定名
    > * 接口索引 ：描述了这个类实现了哪些接口
* **1.7 字段表集合**
    > 用于描述接口或者类中声明的变量
* **1.8 方法表集合**
    > 用于描述方法
* **1.9 属性表集合**
    > 在Class文件、字段表、方法表都可以携带自己的属性表集合，以用于描述专有的信息
    > * Code属性
    > 方法体中的代码经过javac编译器处理后，最终变为字节码指令存储在Code属性内

## 2. 字节码指令简介

* **2.1 Java虚拟机的指令**
    > 由**一个字节**长度的 、代表着某种特定操作含义的数字 ( 称为**操作码** ) 以及跟随其后的零至多个代表此操作所需参数 ( 称为**操作数** ) 而构成
    > * 大多数指令都不含操作数，只有一个操作码
